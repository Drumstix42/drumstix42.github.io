var K=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var M=(e,t,n)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,T=(e,t)=>{for(var n in t||(t={}))Z.call(t,n)&&M(e,n,t[n]);if(j)for(var n of j(t))ee.call(t,n)&&M(e,n,t[n]);return e},E=(e,t)=>W(e,X(t));import{L as V,o as p,d as S,e as a,M as te,O as ne,P as R,Q as N,r as i,c as v,a as c,w as r,t as w,f as q,R as B,S as U,T as H,b as L,F as z,U as se,V as oe}from"./vendor.bc05a8e9.js";import{_ as A}from"./index.41492ff0.js";function P(e,t,n){var s,o,d,b,h;t==null&&(t=100);function m(){var l=Date.now()-b;l<t&&l>=0?s=setTimeout(m,t-l):(s=null,n||(h=e.apply(d,o),d=o=null))}var _=function(){d=this,o=arguments,b=Date.now();var l=n&&!s;return s||(s=setTimeout(m,t)),l&&(h=e.apply(d,o),d=o=null),h};return _.clear=function(){s&&(clearTimeout(s),s=null)},_.flush=function(){s&&(h=e.apply(d,o),d=o=null,clearTimeout(s),s=null)},_}P.debounce=P;var Q=P;const ae={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 448 512"},ie=a("path",{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z",fill:"currentColor"},null,-1);var ce=V({name:"Plus",render:function(t,n){return p(),S("svg",ae,[ie])}});const le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 448 512"},re=a("path",{d:"M176 352h-48V48a16 16 0 0 0-16-16H80a16 16 0 0 0-16 16v304H16c-14.19 0-21.36 17.24-11.29 27.31l80 96a16 16 0 0 0 22.62 0l80-96C197.35 369.26 190.22 352 176 352zm240-64H288a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h56l-61.26 70.45A32 32 0 0 0 272 446.37V464a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-56l61.26-70.45A32 32 0 0 0 432 321.63V304a16 16 0 0 0-16-16zm31.06-85.38l-59.27-160A16 16 0 0 0 372.72 32h-41.44a16 16 0 0 0-15.07 10.62l-59.27 160A16 16 0 0 0 272 224h24.83a16 16 0 0 0 15.23-11.08l4.42-12.92h71l4.41 12.92A16 16 0 0 0 407.16 224H432a16 16 0 0 0 15.06-21.38zM335.61 144L352 96l16.39 48z",fill:"currentColor"},null,-1);var de=V({name:"SortAlphaDown",render:function(t,n){return p(),S("svg",le,[re])}});const ue={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 352 512"},_e=a("path",{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28L75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256L9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z",fill:"currentColor"},null,-1);var F=V({name:"Times",render:function(t,n){return p(),S("svg",ue,[_e])}});Object.freeze({1:"1"});function pe(e=[]){const t={};return e.forEach(n=>{const s=n.Name;t[s]={label:s,id:s,inputs:[],sources:[],preferredSource:null,quantity:1},(n.Inputs||[]).forEach(o=>{t[s].inputs.push({id:o.Element.RowName,quantity:o.Count})}),(n.RecipeSets||[]).forEach(o=>{t[s].sources.push(o.RowName)}),t[s].preferredSource=t[s].sources[0],(n.Outputs||[]).forEach(o=>{(s===o.Element.RowName||s.includes(o.Element.RowName))&&(t[s].quantity=o.Count)})}),t}const me=()=>Date.now(),G=()=>te({id:me(),title:"Planning",items:[]}),Y=(e,t)=>t.findIndex(n=>n.id===e),J=G(),he=J.id,I=ne("icarus",{state:()=>({activeTabId:he,tabs:[J],recipeData:{},recipeOptions:[],isLoadingRecipes:!1,recipeSearch:""}),getters:{activeTab:e=>e.tabs.find(t=>t.id===e.activeTabId),tabCount(){return this.tabs.length},sortedRecipeOptions(e){return e.recipeOptions.sort((t,n)=>t.label.localeCompare(n.label))},filteredRecipeOptions(e){if(e.recipeSearch){const t=e.recipeSearch.toLowerCase();return this.sortedRecipeOptions.filter(n=>n.label.toLowerCase().includes(t))}return this.sortedRecipeOptions}},actions:{addTab(){const e=G();return this.tabs.push(e),e},removeTab(e){const t=Y(e,this.tabs);if(t!==-1)this.tabs.splice(t,1);else{console.error(`Could not find tab with id ${e}`,this.tabs);return}const n=Math.min(t,this.tabs.length-1),s=this.tabs[n];this.activeTabId=s.id},setActiveTab(e){this.activeTabId=e},setTabTitle(e,t){const n=Y(e,this.tabs);n!==-1&&(this.tabs[n].title=t)},addItem(e,t=1){const n=this.activeTab;if(n){const s=n.items.find(o=>o.id===e);s?s.quantity+=t:n.items.push({id:e,quantity:t})}else console.error(`Could not find tab with id ${this.activeTabId}`,this.tabs)},removeItem(e){const t=this.activeTab;if(t){const n=t.items.findIndex(s=>s.id===e);t.items.splice(n,1)}else console.error(`Could not find tab with id ${this.activeTabId}`,this.tabs)},async loadRecipeData(){this.isLoadingRecipes=!0;const t=await(await fetch("/Icarus/Data/Recipes.json",{method:"GET",headers:{"Content-Type":"application/json"}})).json(),n=pe(t==null?void 0:t.Rows);console.log(n),this.recipeData=n,this.recipeOptions=Object.values(n),this.isLoadingRecipes=!1}}});const be=I(),fe={name:"CraftingToolItemSelector",components:{Plus:ce},props:{},data(){return{searchValue:null}},computed:T({},R(I,["isLoadingRecipes","filteredRecipeOptions"])),methods:E(T({},N(I,["addItem"])),{onSearch:Q.debounce(e=>{be.recipeSearch=e},100)})},ve={class:"mb-3"},ge=["onClick"],Ce={class:"flex-shrink",style:{"min-width":"0"}},Ie={class:"label text-overflow-ellipsis"},ye=q(" Add to list ");function Te(e,t,n,s,o,d){const b=i("n-input"),h=i("n-image"),m=i("Plus"),_=i("n-icon"),l=i("n-button"),g=i("n-tooltip"),f=i("RecycleScroller"),k=i("n-card"),x=i("n-spin");return p(),v("div",null,[c("div",ve,[a(b,{type:"text",value:o.searchValue,"onUpdate:value":t[0]||(t[0]=C=>o.searchValue=C),placeholder:"Search...",clearable:"",onInput:d.onSearch},null,8,["value","onInput"])]),a(x,{show:e.isLoadingRecipes},{default:r(()=>[a(k,{class:"scroll-wrap","content-style":"padding: 0;"},{default:r(()=>[a(f,{class:"scroller",items:e.filteredRecipeOptions,"item-size":40,"key-field":"id"},{default:r(({index:C,item:u})=>[c("div",{class:"recipe-item flex align-items-center",onClick:y=>e.addItem(u.id)},[a(h,{class:"icon",width:"32",src:`/Icarus/ItemIcons/ITEM_${u.id}.png`,"fallback-src":"/Icarus/Images/question-mark.png","preview-disabled":!0},null,8,["src"]),c("div",Ce,[c("div",Ie,w(u.label),1)]),a(g,{trigger:"hover"},{trigger:r(()=>[a(l,{class:"hover-button ml-auto",secondary:"",type:"default",size:"small"},{default:r(()=>[a(_,{size:"13"},{default:r(()=>[a(m)]),_:1})]),_:1})]),default:r(()=>[ye]),_:1})],8,ge)]),_:1},8,["items"])]),_:1})]),_:1},8,["show"])])}var we=A(fe,[["render",Te],["__scopeId","data-v-909d7692"]]);const xe={name:"CraftingToolManageTab",components:{Times:F},props:{tab:{type:Object,required:!0}},emits:["removeTab"],data(){return{}},computed:T({},R(I,["tabs","tabCount"])),methods:{removeTab(){this.$emit("removeTab",{tabId:this.tab.id})}}},Se=e=>(U("data-v-42d8af9e"),e=e(),H(),e),ke={class:"manage-tab flex align-items-center"},qe={class:"flex-grow-1 flex align-items-center"},$e={class:"flex align-items-center"},De=Se(()=>c("span",{class:"flex-shrink-0 mr-3"},"List Name:",-1)),Re=q(" Delete Tab ");function Le(e,t,n,s,o,d){const b=i("n-input"),h=i("Times"),m=i("n-icon"),_=i("n-button"),l=i("n-tooltip");return p(),v("div",ke,[c("div",qe,[c("div",$e,[De,a(b,{type:"text",value:n.tab.title,"onUpdate:value":t[0]||(t[0]=g=>n.tab.title=g),placeholder:"Name"},null,8,["value"])])]),e.tabCount>1?(p(),S(l,{key:0,trigger:"hover"},{trigger:r(()=>[a(_,{class:"",secondary:"",type:"error",onClick:d.removeTab},{default:r(()=>[a(m,{size:"20"},{default:r(()=>[a(h)]),_:1})]),_:1},8,["onClick"])]),default:r(()=>[Re]),_:1})):B("",!0)])}var ze=A(xe,[["render",Le],["__scopeId","data-v-42d8af9e"]]);const Ae={name:"CraftingToolComponentSourcePicker",components:{},props:{componentId:{type:String,required:!0}},data(){return{}},computed:T({},R(I,["recipeData"])),methods:{setComponentPreferredSource(e,t){this.recipeData[e].preferredSource=t,this.$emit("change")}}};function Oe(e,t,n,s,o,d){const b=i("n-button"),h=i("n-button-group");return e.recipeData[n.componentId]?(p(),S(h,{key:0,size:"small"},{default:r(()=>[(p(!0),v(z,null,L(e.recipeData[n.componentId].sources,(m,_)=>(p(),S(b,{key:m,class:"mx-1",size:"tiny",ghost:"",round:"",type:"info",style:se([e.recipeData[n.componentId].preferredSource===m?null:"--n-border: 1px solid rgba(255, 255, 255, 0.2); --n-text-color: #bbb"]),onClick:l=>d.setComponentPreferredSource(n.componentId,m)},{default:r(()=>{var l,g;return[c("span",null,w((g=(l=e.recipeData[m])==null?void 0:l.label)!=null?g:m),1)]}),_:2},1032,["style","onClick"]))),128))]),_:1})):B("",!0)}var Ee=A(Ae,[["render",Oe]]);const Ve={name:"CraftingToolCalculator",components:{ComponentSourcePicker:Ee,SortAlphaDown:de,Times:F},props:{tab:{type:Object,required:!0}},data(){return{requiredItemData:{},requiredCraftingStations:[],requiredComponents:[],includeSubComponents:!1,includeCraftingStations:!1}},watch:{includeSubComponents(e){e||(this.includeCraftingStations=!1),this.triggerCalc()},includeCraftingStations(e){e&&(this.includeSubComponents=!0),this.triggerCalc()}},computed:T({},R(I,["recipeData"])),methods:{sortInputs(){this.tab.items.sort((e,t)=>{const n=this.recipeData[e.id].label,s=this.recipeData[t.id].label;return n.localeCompare(s)})},onQuantityChange(e){e.quantity<1?this.$nextTick(()=>{this.removeItem(e),this.triggerCalc()}):this.$nextTick(()=>{this.triggerCalc()})},validateQuantity(e){return Number.isInteger(e)},removeItem(e){const t=(this.tab.items||[]).findIndex(n=>n.id===e.id);t>-1&&this.tab.items.splice(t,1)},triggerCalc:Q.debounce(function(){this.calculateRequiredItems()},100),calculateRequiredItems(){const e=this.recipeData,t=this.includeSubComponents,n=this.includeCraftingStations,s={},o=new Set([]);function d(_=[],l={}){return _.forEach(g=>{var x;const f=e[g.id];if(!f)return;const k=(x=g.quantity)!=null?x:1;(f.inputs||[]).forEach(C=>{var D;const u=(D=l[C.id])!=null?D:0;l[C.id]=u+C.quantity*k;const y=e[C.id];t&&y&&d([{id:C.id,quantity:C.quantity*k}],l)})}),l}function b(){Object.keys(s).forEach(_=>{const l=e[_];(l==null?void 0:l.preferredSource)&&o.add(l.preferredSource)})}d(this.tab.items,s),b(),n&&d([...o].map(_=>({id:_})),s),b();const m=Object.keys(s).map(_=>({id:_,quantity:s[_]})).sort((_,l)=>l.quantity-_.quantity);console.log(o),this.requiredCraftingStations=[...o],this.requiredItemData=s,this.requiredComponents=m}}},$=e=>(U("data-v-b7fdd59e"),e=e(),H(),e),Pe={key:0},je={class:"flex align-items-center"},Me=$(()=>c("h3",null,"Items",-1)),Ne=q(" Sort items alphabetically "),Be={class:"flex-shrink",style:{"min-width":"0"}},Ue={class:"label text-overflow-ellipsis"},He=q(" Remove from list "),Qe=$(()=>c("div",{class:"flex align-items-center mt-3"},[c("h3",null,"Components")],-1)),Fe={class:"p-1"},Ge={class:"flex align-items-center mb-1"},Ye=$(()=>c("span",null,"Include sub-components",-1)),Je={class:"flex align-items-center mb-3 ml-3"},Ke=$(()=>c("span",null,"Include station components",-1)),We={class:"label"},Xe=$(()=>c("div",{class:"flex align-items-center"},[c("h3",null,"Crafting Stations")],-1)),Ze={class:""},et={class:"recipe-item pl-0 flex align-items-center"},tt={class:"flex align-items-center"},nt={class:"label"},st={key:1,class:"mb-3"},ot=$(()=>c("h3",null,"No Items",-1)),at=q("You haven't added any items to this list yet.");function it(e,t,n,s,o,d){const b=i("SortAlphaDown"),h=i("n-icon"),m=i("n-button"),_=i("n-tooltip"),l=i("n-input-number"),g=i("n-image"),f=i("component-source-picker"),k=i("Times"),x=i("n-switch"),C=i("n-text");return p(),v("div",null,[n.tab.items.length>0?(p(),v("div",Pe,[c("div",je,[Me,a(_,{trigger:"hover"},{trigger:r(()=>[a(m,{class:"ml-3",size:"tiny",secondary:"",circle:"",type:"default",onClick:d.sortInputs},{default:r(()=>[a(h,{size:"13"},{default:r(()=>[a(b)]),_:1})]),_:1},8,["onClick"])]),default:r(()=>[Ne]),_:1})]),a(oe,{"x-appear":"",name:"list",tag:"div"},{default:r(()=>[(p(!0),v(z,null,L(n.tab.items,u=>(p(),v("div",{class:"recipe-item flex align-items-center",key:u.id},[a(l,{class:"input-quantity flex-shrink-0",value:u.quantity,"onUpdate:value":y=>u.quantity=y,placeholder:"Quantity",min:0,max:1e5,validator:d.validateQuantity,"on-update-value":d.onQuantityChange(u)},null,8,["value","onUpdate:value","validator","on-update-value"]),a(g,{class:"icon",width:"32",src:`/Icarus/ItemIcons/ITEM_${e.recipeData[u.id].id}.png`,"fallback-src":"/Icarus/Images/question-mark.png","preview-disabled":!1},null,8,["src"]),c("div",Be,[c("div",Ue,w(e.recipeData[u.id].label),1)]),a(f,{"component-id":u.id,onChange:t[0]||(t[0]=y=>d.triggerCalc())},null,8,["component-id"]),a(_,{trigger:"hover"},{trigger:r(()=>[a(m,{class:"hover-button ml-auto",secondary:"",type:"error",size:"small",onClick:y=>d.removeItem(u)},{default:r(()=>[a(h,{size:"13"},{default:r(()=>[a(k)]),_:1})]),_:2},1032,["onClick"])]),default:r(()=>[He]),_:2},1024)]))),128))]),_:1}),Qe,c("div",Fe,[c("div",Ge,[a(x,{class:"mr-2",value:o.includeSubComponents,"onUpdate:value":t[1]||(t[1]=u=>o.includeSubComponents=u),size:"small"},null,8,["value"]),Ye]),c("div",Je,[a(x,{class:"mr-2",value:o.includeCraftingStations,"onUpdate:value":t[2]||(t[2]=u=>o.includeCraftingStations=u),size:"small"},null,8,["value"]),Ke]),c("div",null,[(p(!0),v(z,null,L(o.requiredComponents,u=>{var y,D;return p(),v("div",{key:u.id,class:"component-row flex align-items-center"},[c("div",We,w(u.quantity)+" "+w((D=(y=e.recipeData[u.id])==null?void 0:y.label)!=null?D:u.id),1),a(f,{"component-id":u.id,onChange:t[3]||(t[3]=vt=>d.triggerCalc())},null,8,["component-id"])])}),128))])]),Xe,c("div",Ze,[(p(!0),v(z,null,L(o.requiredCraftingStations,u=>(p(),v("div",et,[c("div",tt,[a(g,{class:"icon",width:"32",src:`/Icarus/ItemIcons/ITEM_${e.recipeData[u].id}.png`,"fallback-src":"/Icarus/Images/question-mark.png","preview-disabled":!1},null,8,["src"]),c("div",nt,w(u),1)])]))),256))])])):(p(),v("div",st,[ot,a(C,{type:"info"},{default:r(()=>[at]),_:1})]))])}var ct=A(Ve,[["render",it],["__scopeId","data-v-b7fdd59e"]]);const O=I(),lt={name:"CraftingToolTabView",components:{ManageTab:ze,CraftingCalculator:ct},props:[],data(){return{activeTabId:O.activeTabId,maxTabCount:20,addable:!0,closable:!0}},watch:{activeTabId:function(e){this.setActiveTab(e)}},computed:T({},R(I,["tabs","tabCount","activeTab"])),methods:E(T({},N(I,["setActiveTab"])),{handleAdd(){},handleClose(){},addTab(){const e=O.addTab();this.setActiveTab(e.id),this.syncSelectedTab()},removeTab({tabId:e}={}){O.removeTab(e),this.syncSelectedTab()},syncSelectedTab(){this.activeTabId=O.activeTabId,this.$nextTick(()=>{var e;(e=this.$refs.tabsInstRef)==null||e.syncBarPosition()})}})},rt={class:"flex align-items-center mb-3"},dt={class:"flex align-items-center ml-auto"},ut={class:"mr-3"},_t=c("span",null,"Add Tab",-1);function pt(e,t,n,s,o,d){const b=i("n-button"),h=i("manage-tab"),m=i("crafting-calculator"),_=i("n-tab-pane"),l=i("n-tabs"),g=i("n-card");return p(),v("div",null,[c("div",rt,[c("div",dt,[c("div",ut,w(e.tabCount)+" / "+w(o.maxTabCount),1),a(b,{class:"",strong:"",secondary:"",type:"primary",onClick:d.addTab,disabled:e.tabCount===o.maxTabCount},{default:r(()=>[_t]),_:1},8,["onClick","disabled"])])]),a(g,null,{default:r(()=>[a(l,{ref:"tabsInstRef",value:o.activeTabId,"onUpdate:value":t[0]||(t[0]=f=>o.activeTabId=f),type:"bar",addable:o.addable,closable:o.closable,"tab-style":""},{default:r(()=>[(p(!0),v(z,null,L(e.tabs,f=>(p(),S(_,{tab:f.title,name:f.id,key:f.id},{default:r(()=>[a(h,{tab:f,onRemoveTab:d.removeTab},null,8,["tab","onRemoveTab"]),a(m,{tab:f},null,8,["tab"])]),_:2},1032,["tab","name"]))),128))]),_:1},8,["value","addable","closable"])]),_:1})])}var mt=A(lt,[["render",pt]]);const ht={class:"icarus-wrap"},bt=q(" Search and add items from the list below to add them to your to-do list, which will calculate your item requirements. "),ft={class:"flex flex-wrap"},yt={setup(e){return I().loadRecipeData(),(n,s)=>{const o=i("n-alert");return p(),v("div",ht,[a(o,{class:"m-2 mb-4",title:"Crafting Calculator",type:"info",closable:""},{default:r(()=>[bt]),_:1}),c("div",ft,[a(we,{class:"item-selector"}),a(mt,{class:"tab-view flex-1"})])])}}};export{yt as default};
